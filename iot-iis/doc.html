<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0067)https://www.fit.vutbr.cz/study/courses/IIS/private/projekt/doc.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2"></head>
    
    <title>Projekt IIS</title>
    <style type="text/css">
    	table { border-collapse: collapse; }
    	td, th { border: 1px solid black; padding: 0.3em 0.5em; text-align: left; }
    	dt { font-weight: bold; margin-top: 0.5em; }
    </style>

<!-- Zkontrolujte prosím nastavení kódování v hlavičce dokumentu 
     podle použitého editoru -->

<h1>IoT: správa zařízení</h1> <!-- Nahradte názvem svého zadání -->

<dl>
	<dt>Autoři</dt>
	<dd>První jméno <!-- Nahraďte skutečným jménem a e-mailem autora a popisem činnosti -->
	    <a href="mailto:xkalen07@stud.fit.vutbr.cz">xkalen07@stud.fit.vutbr.cz</a> -
		uživatelské rozhraní, nasazení systému, testování
	</dd>
	<dd>Druhé jméno <!-- Nahraďte skutečným jménem a e-mailem autora a popisem činnosti -->
	    <a href="mailto:xkubin27@stud.fit.vutbr.cz">xkubin27@stud.fit.vutbr.cz</a> -
		implementační prostředí, autentizace, autorizace, testování
	</dd>
  <dd>Třetí jméno <!-- Nahraďte skutečným jménem a e-mailem autora a popisem činnosti -->
	    <a href="mailto:xstrei06@stud.fit.vutbr.cz">xstrei06@stud.fit.vutbr.cz</a> -
		Modely databáze, implementace databáze, implementace prisma dotazů, testování
	</dd>
	<dt>URL aplikace</dt>
	<dd><a href="https://vut-iis.vercel.app/">https://vut-iis.vercel.app/</a></dd>
</dl>

<h2>Uživatelé systému pro testování</h2>
<p>Uveďte prosím existující zástupce <strong>všech rolí uživatelů</strong>.</p>
<table>
<tbody><tr><th>Login</th><th>Heslo</th><th>Role</th></tr>
<tr><td>admin</td><td>4Adm1n$#23</td><td>Administrátor</td></tr>
<tr><td>Pepa</td><td>Pepa123</td><td>Uživatel</td></tr>
<tr><td>Franta</td><td>frantik123</td><td>Uživatel</td></tr>
<tr><td>broker</td><td>3r0k3r</td><td>Broker</td></tr>
</tbody></table>

<h3>Video</h3>

<a href="https://youtu.be/tjKeWOYPFXk">https://youtu.be/tjKeWOYPFXk</a>

<h2>Implementace</h2>

<h3>Technologie</h3>
	<ul>
		<li>Uživatelské rozhraní - Next.js (React.js)</li>
		<li>Implementační prostředí - Next.js (Node.js)</li>
		<li>Autentizace - next-auth</li>
		<li>Autorizace - next-auth</li>
		<li>databáze - Postgres</li>
		<li>Hosting databáze - Supabase</li>
		<li>ORM - Prisma</li>
		<li>Hosting aplikace - Vercel</li>
		<li>Repozitář - GitHub</li>
	</ul>

<h3>Struktura aplikace</h3>
	<ul>
		<li>app/profile - složka obsahující jednotlivé stránky aplikace</li>
		<li>app/api - složka obsahující implementační prostředí</li>
		<li>components - složka obsahující komponenty aplikace</li>
		<li>prisma - složka obsahující prisma schéma pro databázi</li>
		<li>.env - soubor obsahující proměnné pro připojení k databázi a správné fungování next-auth</li>
		<li>package.json - soubor obsahující informace o aplikaci a jejích balíčcích</li>
		<li>package-lock.json - soubor obsahující informace o aplikaci a jejích balíčcích, včetně konkrétních verzí</li>
		<li>README.md - soubor obsahující informace o aplikaci</li>
	</ul>

<h3>Složka API</h3>
	<ul>
		<li>auth - složka s implementací vlastního poskytovatele pro autentizaci a autorizaci</li>
		<li>broker - implementace implementačního prostředí pro brokera</li>
		<li>profile - implementační prostředí pro uživatele a systémy</li>
	</ul>

<h3>Složka profile</h3>
	<ul>
		<li>page.tsx - úvodní stránka</li>
		<li>profile/[username]/page.tsx - přehled daného uživatele</li>
		<li>profile/[username]/devices/page.tsx - přehled zařízení</li>
		<li>profile/[username]/devices/[deviceId]/page.tsx - přehled detailu zařizení a jeho editace</li>
		<li>profile/[username]/devices/[deviceId]/kpi/page.tsx - tvorba nového KPI</li>
		<li>profile/[username]/devices/[deviceId]/manageKpi/page.tsx - přehled KPIs daného zařízení</li>
		<li>profile/[username]/devices/[deviceId]/manageKpi/[kpiId]/page.tsx - editace daného kpi</li>
		<li>profile/[username]/devices/createDevice/page.tsx - vytváření nového zařízení, případně nového typu a jeho parametrů</li>
		<li>profile/[username]/deviceTypes/page.tsx - přehled typu zařízení daného uživatele</li>
		<li>profile/[username]/edit/page.tsx - stránka pro úpravu hesla uživatele</li>
		<li>profile/[username]/manage/page.tsx - administrativní stránka s přehledem uživatelů</li>
		<li>profile/[username]/systems/page.tsx - přehled systémů daného uživatele</li>
		<li>profile/[username]/systems/[systemId]/page.tsx - stránka s detaily daného uživatele</li>
		<li>profile/[username]/systems/[systemId]/editSystem/page.tsx - stránka pro editováni daného systému</li>
		<li>profile/[username]/systems/addSystem/page.tsx - stránka pro tvorbu nového systému</li>
		<li>profile/[username]/systems/sharedSystem/page.tsx - přehled systémů sdílených danému uživateli</li>
		<li>profile/login/page.tsx - stránka na přihlášení</li>
		<li>profile/register/page.tsx - stránka na registraci</li>
	</ul>

<h3>Databáze</h3>

<img src="IIS.png" alt="Databáze" width="600" height="600">

<h2>Instalace</h2>

<ul>
<li>Aplikace i databáze běží na vzdálených serverech, respektive Vercel pro aplikaci a Supabase na Postgres databázi.</li>
<li>Ke spuštění jsou potřeba následující: Node.js 18 a vyšší, správce balíčků npm nebo pnpm, ostatní požadované balíčky se stáhnou příkazem "npm install"</li>
<li>Dodatečně jsou požadované 4 proměnné v souboru .env, které však z bezpečnostních důvodů nedistribuujeme</li>
<li>Se všemi potřebnými údaji a požadavky poté stačí použít příkazy "npx prisma generate" a poté "npm run dev" pro lokální spuštění</li>
</ul>

<h2>Známé problémy</h2>
	<p>
		Broker je implementován pomocí python skriptu iis_broker.py. Pomocí tohoto skriptu se aktualizují vybrané hodnoty senzorů v systému. Příkladem spuštění je následující příkaz: ( python3 iis_broker.py "https://vut-iis.vercel.app/api/broker" "Franta" "Device 1" "temperature" 20 ) . Tento příkaz aktualizuje uživateli Franta hodnotu přístroje Device 1, Parametr temperature na hodnotu 20, první hodnoutou je api cesta. Při spuštění skriptu je nutné mít nainstalovaný python3 a knihovnu requests. Skript je možné spustit i na jiném stroji, než na kterém běží aplikace.
		Tato implementace brokera je pouze demonstrační a není určena pro ostrý provoz.
	</p>
	<p>
		Broker v aktualním stavu vyžaduje znalost identifikátorů parametrů a přístrojů.
	</p>
	<p>
		Aplikace nepodporuje zobrazení na mobilním zařízení, obecněji menších displejí, než je běžné na noteboocích.
	</p>
	<p>
		Dalsi mozne prikazy pro spusteni brokera jsou:
		<ul>
			<li>Frantův device 1 nastavující temperature na 20: python3 iis_broker.py "https://vut-iis.vercel.app/api/broker" "Franta" "Device 1" "temperature" 20</li>
			<li>Frantův device 1 nastavující wind speed na 50: python3 iis_broker.py "https://vut-iis.vercel.app/api/broker" "Franta" "Device 1" "wind speed" 20</li>
			<li>python3 iis_broker.py 85 23 22 "broker" "3r0k3r" "https://vut-iis.vercel.app/api/broker" "https://vut-iis.vercel.app/api/broker"</li>
</ul>
	</p>


<h2>Testování</h2>
	<p>
		Testování proběhlo všemi vývojáři ručními E2E testy.
	</p>

<h2>Rozdíly od zadání</h2>
	<p>
		<ul>
			<li>Uživatelé se přidávají do systému na základě pozvánky od vlastníka systému, nikoliv na podnět žádosti o přidání</li>
			<li>Každý uživatel má vlastní typy zařízení</li>
			<li>SQL skript není dodán, databáze je již inicializována ve vzdálenem serveru, v případě, že databáze je prázdná, příkaz "npx prisma db push" inicializuje databázi na základě schématu prisma/schema.prisma</li>
		</ul>
	</p>
</html>
